var map,neighborhood,model={loadMap:function(){function e(e,o){if(o==google.maps.places.PlacesServiceStatus.OK){for(var n=[],t=0;t<e.length;t++)n.push(e[t].place_id);for(var t=0;t<n.length;t++){var r={placeId:n[t]};a.getDetails(r,function(e,o){o==google.maps.places.PlacesServiceStatus.OK&&(vm.placesDetails.push(e),vm.createMarker(e))})}}}neighborhood=ko.computed(function(){return new google.maps.LatLng(vm.lat(),vm.lng())}),map=ko.observable(new google.maps.Map(document.getElementById("mapCanvas"),{center:neighborhood(),zoom:17}));var o={location:neighborhood(),radius:"500",openNow:!0,types:["restaurant"]},a=new google.maps.places.PlacesService(map());a.nearbySearch(o,e),vm.infowindow(new google.maps.InfoWindow)}},ViewModel=function(){var e=this;e.lat=ko.observable(40.8621822),e.lng=ko.observable(-73.8935974),e.init=function(){var e=document.createElement("script");$(e).attr("type","text/javascript"),e.onerror=function(e){alert(e)},e.src="https://maps.googleapis.com/maps/api/js?libraries=places&signed_in=true&key=AIzaSyD-ea-0b-EOXWC6svLpOyxcBKs3ecfe1co&callback=model.loadMap",$("body").append(e)},e.infowindow=ko.observable(),e.placesDetails=ko.observableArray([]),e.markers=ko.observableArray([]),e.query=ko.observable(""),e.search=ko.computed(function(){return ko.utils.arrayFilter(e.markers(),function(o){return o.title.toLowerCase().indexOf(e.query().toLowerCase())>=0})}),e.search.subscribe(function(){e.setMarkers()}),e.createMarker=function(o){var a=o.geometry.location,n=new google.maps.Marker({map:map(),position:a,animation:google.maps.Animation.DROP,title:o.name});n.info=new google.maps.InfoWindow({content:'<h4 class="text-center">'+o.name+"</h4><p>"+o.vicinity+"</p>"}),google.maps.event.addListener(n,"click",function(){n.info.open(map(),n)}),e.markers.push(n)},e.deleteMarkers=function(){for(var o=0;o<e.markers().length;o++)e.markers()[o].setMap(null)},e.setMarkers=function(){e.deleteMarkers();for(var o=0;o<e.search().length;o++)e.search()[o].setMap(map())},e.highlightMarker=function(e,o){console.log(e),e.setAnimation(null!=e.getAnimation()?null:google.maps.Animation.BOUNCE),window.setTimeout(function(){e.setAnimation(null)},7e3),e.info.open(map(),e)},e.init()},vm=new ViewModel;ko.applyBindings(vm);