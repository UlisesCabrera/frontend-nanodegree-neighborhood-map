var map,neighborhood,model={loadMap:function(){function e(e,o){if(o==google.maps.places.PlacesServiceStatus.OK)for(var a=0;a<e.length;a++)vm.places.push(e[a])}neighborhood=ko.computed(function(){return new google.maps.LatLng(vm.lat(),vm.lng())}),map=ko.observable(new google.maps.Map(document.getElementById("mapCanvas"),{center:neighborhood(),zoom:17}));var o={location:neighborhood(),radius:"500",types:["store"]},a=new google.maps.places.PlacesService(map());a.nearbySearch(o,e)}},ViewModel=function(){var e=this;e.lat=ko.observable(40.8621822),e.lng=ko.observable(-73.8935974),e.init=function(){var e=document.createElement("script");$(e).attr("type","text/javascript"),e.onerror=function(e){alert(e)},e.src="https://maps.googleapis.com/maps/api/js?libraries=places&signed_in=true&key=AIzaSyD-ea-0b-EOXWC6svLpOyxcBKs3ecfe1co&callback=model.loadMap",$("body").append(e)},e.places=ko.observableArray([]),e.query=ko.observable(""),e.search=ko.computed(function(){return ko.utils.arrayFilter(e.places(),function(o){return e.createMarker(o),o.name.toLowerCase().indexOf(e.query().toLowerCase())>=0})}),e.createMarker=function(e){var o=e.geometry.location,a=e.photos?e.photos[0].getUrl({maxWidth:200,maxHeight:200}):"images/sample.jpg",t=new google.maps.Marker({map:map(),position:o,title:e.name}),n=new google.maps.InfoWindow({content:'<h4 class="text-center">'+e.name+'</h4><img src="'+a+'" class="img-responsive">'});google.maps.event.addListener(t,"click",function(){n.open(map(),this)})},e.init()},vm=new ViewModel;ko.applyBindings(vm);