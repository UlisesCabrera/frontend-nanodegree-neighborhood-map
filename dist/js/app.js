var map,neighborhood,model={loadMap:function(){function e(e,a){if(a==google.maps.places.PlacesServiceStatus.OK)for(var n=[],t=0;t<e.length;t++){n.push(e[t].place_id);var r={placeId:n[t]};o.getDetails(r,function(e,a){a==google.maps.places.PlacesServiceStatus.OK&&(vm.placesDetails.push(e),vm.createMarker(e))})}}neighborhood=ko.computed(function(){return new google.maps.LatLng(vm.lat(),vm.lng())}),map=ko.observable(new google.maps.Map(document.getElementById("mapCanvas"),{center:neighborhood(),zoom:17}));var a={location:neighborhood(),radius:"200",types:["restaurant"]},o=new google.maps.places.PlacesService(map());o.nearbySearch(a,e)}},ViewModel=function(){var e=this;e.lat=ko.observable(40.8621822),e.lng=ko.observable(-73.8935974),e.init=function(){var e=document.createElement("script");$(e).attr("type","text/javascript"),e.onerror=function(e){alert(e)},e.src="https://maps.googleapis.com/maps/api/js?libraries=places&signed_in=true&key=AIzaSyD-ea-0b-EOXWC6svLpOyxcBKs3ecfe1co&callback=model.loadMap",$("body").append(e)},e.placesDetails=ko.observableArray([]),e.markers=ko.observableArray([]),e.query=ko.observable(""),e.search=ko.computed(function(){return ko.utils.arrayFilter(e.markers(),function(a){return a.title.toLowerCase().indexOf(e.query().toLowerCase())>=0})}),e.search.subscribe(function(){e.setMarkers()}),e.createMarker=function(a){var o=a.geometry.location,n=new google.maps.Marker({map:map(),position:o,draggable:!0,animation:google.maps.Animation.DROP,title:a.name});n.info=new google.maps.InfoWindow({content:'<h4 class="text-center">'+a.name+"</h4><p>"+a.vicinity+"</p>"}),google.maps.event.addListener(n,"click",function(){n.info.open(map(),n)}),e.markers.push(n)},e.deleteMarkers=function(){for(var a=0;a<e.markers().length;a++)e.markers()[a].setMap(null)},e.setMarkers=function(){e.deleteMarkers();for(var a=0;a<e.search().length;a++)e.search()[a].setMap(map())},e.highlightMarker=function(e,a){console.log(e),e.setAnimation(null!=e.getAnimation()?null:google.maps.Animation.BOUNCE),window.setTimeout(function(){e.setAnimation(null)},7e3),e.info.open(map(),e)},e.init()},vm=new ViewModel;ko.applyBindings(vm);